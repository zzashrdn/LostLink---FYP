{% extends "base.html" %}
{% block content %}
<div class="report-container">
  <h2>Report Lost / Found Item</h2>

  {% with messages = get_flashed_messages(with_categories=true) %}
    {% if messages %}
      {% for category, message in messages %}
        <div class="flash {{ category }}">{{ message }}</div>
      {% endfor %}
    {% endif %}
  {% endwith %}

  <form method="POST" enctype="multipart/form-data" class="report-form">
    <!-- Item Info -->
    <h3>Item Information</h3>
    <input type="text" name="item_name" placeholder="Item Name (e.g. Student ID Card, Wallet)" required>
    <textarea name="description" placeholder="Description (e.g. Black wallet with silver chain)" required></textarea>
    <input type="text" name="location" placeholder="Location Found/Lost (e.g. Block 1, Cafeteria)" required>

    <label>Status:</label>
    <select name="status" id="status" required>
      <option value="lost">Lost</option>
      <option value="found">Found</option>
    </select>

    <!-- Security Verification -->
    <div id="security-section" style="display: none;">
      <h3>Security Verification</h3>
      <p>Set a question and answer that only the real owner would know.</p>
      <input type="text" name="security_question" placeholder="e.g. What color is the keychain attached to it?">
      <input type="text" name="security_answer" placeholder="Enter the answer (not case-sensitive)">
    </div>

    <!-- Upload -->
    <h3>Upload Photo</h3>
    <p>Upload a clear image of the item (optional):</p>
    <input type="file" name="photo" accept="image/*">

    <!-- Contact Info -->
    <div id="contact-section">
      <h3 id="contact-title">Ownerâ€™s Information</h3>
      <p id="contact-desc">Optional: provide your contact if you want admin or finder to reach you.</p>
      <input type="text" id="contact_number" name="contact_number" placeholder="Your Contact Number (e.g. 012-3456789)">
      <input type="email" id="utp_email" name="utp_email" placeholder="Your UTP Email (e.g. username@utp.edu.my)">
    </div>

    <!-- âœ… only one submit button -->
    <button type="submit" class="submit-btn">Submit Report</button>
  </form>

  <!-- ðŸ”™ Back to home (outside form) -->
  <div class="back-btn">
    <a href="{{ url_for('home') }}">
      <button type="button">Back to Home</button>
    </a>
  </div>
</div>

<script>
  const statusSelect = document.getElementById("status");
  const securitySection = document.getElementById("security-section");
  const contactTitle = document.getElementById("contact-title");
  const contactDesc = document.getElementById("contact-desc");
  const contactNumber = document.getElementById("contact_number");
  const utpEmail = document.getElementById("utp_email");

  function toggleSections() {
    const status = statusSelect.value.toLowerCase();

    // Toggle security section
    securitySection.style.display = status === "found" ? "block" : "none";

    if (status === "found") {
      contactTitle.textContent = "Finderâ€™s Contact Information";
      contactDesc.textContent = "This information will only be visible to admin until the claim is approved.";
      contactNumber.required = true;
      utpEmail.required = true;
    } else {
      contactTitle.textContent = "Ownerâ€™s Information";
      contactDesc.textContent = "Optional: provide your contact if you want admin or finder to reach you.";
      contactNumber.required = false;
      utpEmail.required = false;
    }
  }

  toggleSections();
  statusSelect.addEventListener("change", toggleSections);
</script>
{% endblock %}
